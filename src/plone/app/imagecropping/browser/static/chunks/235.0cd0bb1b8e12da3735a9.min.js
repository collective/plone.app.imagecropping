"use strict";(self.webpackChunkplone_imagecropping=self.webpackChunkplone_imagecropping||[]).push([[235],{235:function(t,e,i){i.r(e);i(443);var a=i(472),s=i(269),o=i.n(s),n=i(191);function r(t,e,i,a,s,o,n){try{var r=t[o](n),h=r.value}catch(t){return void i(t)}r.done?e(h):Promise.resolve(h).then(a,s)}var h,p;n.Z.extend({name:"image-cropper",trigger:".pat-image-cropper",parser:"mockup",while_reset:!1,while_init:!0,while_saving:!1,_changed:!1,defaults:{identifier:null,fieldname:null,saveurl:null,authenticator:null,scale:null,preview:null,is_cropped:null,view_mode:3,aspect_ratio:16/9,currrent_x:null,currrent_y:null,currrent_w:null,currrent_h:null,true_width:null,true_height:null},update_badges:function(){if(this.while_saving)return this.$badge_saving.show(),this.$button_save.prop("disabled",!0),this.$button_reset.prop("disabled",!0),void this.$button_remove.prop("disabled",!0);this.$badge_saving.hide(),this.options.is_cropped?(this.$button_remove.prop("disabled",!1),this.$badge_uncropped.hide(),this.$badge_cropped.show()):(this.$button_remove.prop("disabled",!0),this.$badge_uncropped.show(),this.$badge_cropped.hide()),this.crop_changed()?(this.$badge_changed.show(),this.$button_save.prop("disabled",!1),this.$button_reset.prop("disabled",!1)):(this.$badge_changed.hide(),this.options.is_cropped?(this.$button_save.prop("disabled",!0),this.$button_reset.prop("disabled",!0)):(this.$button_save.prop("disabled",!1),this.$button_reset.prop("disabled",!0)))},crop_changed:function(){if(this.while_init||this.while_reset)return!1;if(!o()(".cropper-container",this.$image.parent()).is(":visible"))return this._changed;var t=this.$image.cropper("getData"),e=this.original_data.x-1<t.x&&t.x<this.original_data.x+1,i=this.original_data.y-1<t.y&&t.y<this.original_data.y+1,a=this.original_data.width-1<t.width&&t.width<this.original_data.width+1,s=this.original_data.height-1<t.height&&t.height<this.original_data.height+1;return this._changed=!(e&&i&&a&&s),this._changed},reset:function(){console.log("RESET"),this.while_reset=!0,this.cropper.setData(this.original_data),this.visualize_selected_area(),this.while_reset=!1,this.update_badges()},remove:function(){console.log("REMOVE");var t=this,e={remove:!0,fieldname:this.options.fieldname,scale:this.options.scalename,_authenticator:this.options.authenticator};t.while_saving=!0,t.update_badges(),o().ajax({url:this.options.saveurl,type:"POST",data:e,success:function(e,i,a){t.options.is_cropped=!1,t.while_saving=!1,t.update_badges()},error:function(e,i,a){t.while_saving=!1,t.update_badges(),alert(i,a)}})},save:function(){console.log("SAVE "+this.identifier);var t=this,e=this.$image.cropper("getData"),i={x:e.x,y:e.y,width:e.width,height:e.height,fieldname:this.options.fieldname,scale:this.options.scalename,_authenticator:this.options.authenticator};t.while_saving=!0,t.update_badges(),o().ajax({url:this.options.saveurl,type:"POST",data:i,success:function(e,i,a){t.options.is_cropped=!0,t._changed=!1,t.original_data=o().extend({},t.cropper.getData()),t.while_saving=!1,t.update_badges()},error:function(e,i,a){t.while_saving=!1,t.update_badges(),alert(i,a)}})},visualize_selected_area:function(){var t=this.$image.cropper("getData");o()(".cropx",self.$el).text(Math.round(t.x)),o()(".cropy",self.$el).text(Math.round(t.y)),o()(".cropw",self.$el).text(Math.round(t.width)),o()(".croph",self.$el).text(Math.round(t.height))},notify_visible:function(){this.while_reset=!0,this.cropper.resize(),this.options.is_cropped&&!this.crop_changed()&&(console.log("set to orig"),this.cropper.setData(this.original_data),this.visualize_selected_area()),this.while_reset=!1},limit_minimum_cropping_size:function(){var t=this.$image.cropper("getData"),e={};(t.width<this.options.target_width||t.height<this.options.target_height)&&(e.width=this.options.target_width,e.height=this.options.target_height,t.x+this.options.target_width>this.options.true_width?e.x=this.options.true_width-this.options.target_width:e.x=t.x,t.y+this.options.target_height>this.options.true_height?e.y=this.options.true_height-this.options.target_height:e.y=t.y,e.rotate=t.rotate,e.scaleX=t.scaleX,e.scaleY=t.scaleY,this.while_reset=!0,this.cropper.setData(e),this.while_reset=!1)},init:(h=regeneratorRuntime.mark((function t(){var e,a,s,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.e(933).then(i.t.bind(i,933,23));case 2:t.sent.default,(e=this).$el.parent().hasClass("d-none"),a="#select-"+e.options.identifier,e.options.identifier,s="#croppingarea-"+e.options.identifier,e.identifier=e.options.identifier,e.$image=o()("img.main-image",e.$el),e.$badge_cropped=o()(a+" .badge.cropped"),e.$badge_uncropped=o()(a+" .badge.uncropped"),e.$badge_changed=o()(a+" .badge.changed"),e.$badge_saving=o()(a+" .badge.saving"),e.$button_save=o()(s+" button.save"),e.$button_remove=o()(s+" button.remove"),e.$button_reset=o()(s+" button.reset"),e.$button_save_all=o()("button.save-all"),e.options.current_x=parseFloat(e.options.current_x),e.options.current_y=parseFloat(e.options.current_y),e.options.current_w=parseFloat(e.options.current_w),e.options.current_h=parseFloat(e.options.current_h),e.options.true_width=parseFloat(e.options.true_width),e.options.true_height=parseFloat(e.options.true_height),e.options.target_width=parseFloat(e.options.target_width),e.options.target_height=parseFloat(e.options.target_height),e.options.is_cropped="True"==e.options.is_cropped,e.original_data={x:this.options.current_x,y:this.options.current_y,width:this.options.current_w,height:this.options.current_h,rotate:0,scaleX:1,scaleY:1},e.update_badges(),e.$button_reset.click((function(){e.reset()})),e.$button_remove.click((function(){e.remove()})),e.$button_save.click((function(){e.save()})),e.$button_save_all.on("click",{identifier:e.identifier},(function(t){e.crop_changed()&&e.save()})),n={preview:e.options.preview,data:e.original_data,autoCrop:!0,autoCropArea:1,aspectRatio:parseFloat(e.options.aspect_ratio),viewMode:e.options.view_mode,restore:!1,crop:function(t){e.while_init||e.while_reset||(e.limit_minimum_cropping_size(),e.update_badges(),e.visualize_selected_area())},built:function(){e.reset(),e.while_init=!1}},e.$image.cropper(n),e.cropper=e.$image.data("cropper"),e.$image.on("CROPPERPATTERN.VISIBLE",(function(){e.notify_visible()}));case 33:case"end":return t.stop()}}),t,this)})),p=function(){var t=this,e=arguments;return new Promise((function(i,a){var s=h.apply(t,e);function o(t){r(s,i,a,o,n,"next",t)}function n(t){r(s,i,a,o,n,"throw",t)}o(void 0)}))},function(){return p.apply(this,arguments)})}),n.Z.extend({name:"imagecropsave",trigger:".pat-imagecrop-scaleselect",parser:"mockup",trigger_notify_visible:function(t){console.log("Trigger event");var e=o().Event("CROPPERPATTERN.VISIBLE");t.trigger(e)},toggle_li:function(t){var e=o()(t),i=o()(e.parent());if(!e.hasClass("active")){o()("li.list-group-item.active",i).removeClass("active").addClass("inactive"),e.removeClass("inactive").addClass("active");var a=o()(o()(e.data("cropping-area"))),s=o()(a.parent());o()(".singlecroppingarea.active",s).removeClass("active").addClass("inactive"),a.removeClass("inactive").addClass("active");var n=o()("img.main-image",a);this.trigger_notify_visible(n)}},set_preview_dimensions:function(t){var e=o()(t),i=o()(".preview-container",e),a=o()(".crop-preview",i),s=parseFloat(i.data("target-width")),n=parseFloat(i.data("target-height")),r=e.width(),h=null;h=r>=s?n:n*r/s,i.width(r),i.height(h),a.width(r),a.height(h)},init:function(){i.e(884).then(i.bind(i,884));var t=this;document.querySelector('a[data-bs-toggle="tab"]').addEventListener("shown.bs.tab",(function(t){var e=o()("div.singlecroppingarea.active img.main-image",$fieldset);this.trigger_notify_visible(e)})),o()(".tab-pane",t.$el).each((function(e){o()("li.list-group-item.scalable",o()(this)).each((function(e){var i=this;t.set_preview_dimensions(i),o()(i).click((function(){t.toggle_li(i)}))}))}))}});a.Z.init()}}]);
//# sourceMappingURL=235.0cd0bb1b8e12da3735a9.min.js.map